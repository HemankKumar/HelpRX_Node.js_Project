<!doctype html>
<html lang="en" ng-app="mymodule">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Manage Medicines | HelpRX</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="script/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

<style>
/* ===== GLOBAL ===== */
body{
  background:#f6f8fb;
  font-family:Poppins, sans-serif;
}

/* ===== NAVBAR ===== */
.navbar{
  background:#FFFACD;
}

/* ===== GLASS CARD ===== */
.glass-card{
  background: rgba(255,255,255,0.75);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  border-radius: 18px;
  padding: 28px;
  box-shadow: 0 15px 45px rgba(0,0,0,0.12);
  border: 1px solid rgba(255,255,255,0.3);
}

/* ===== BUTTONS ===== */
.btn-main{
  background:#0d6efd;
  color:#fff;
  border:none;
}
.btn-main:hover{
  background:#0b5ed7;
}

/* ===== TABLE ===== */
.table thead{
  background:#eaf1ff;
}
.table tbody tr:hover{
  background:#f2f7ff;
}

/* ===== CENTER ===== */
.center{
  display:flex;
  justify-content:center;
}
</style>

<script>
$(document).ready(function () {
  $("#logout").click(function () {
    localStorage.removeItem("activeKuch");
    location.href = "index.html";
  });
});

var module = angular.module("mymodule", []);
module.controller("mycontroller", function ($scope, $http) {

  $scope.setActiveUser = function () {
    if (!localStorage.getItem("activeKuch")) {
      location.href = "index.html";
      return;
    }
    $scope.eemail = localStorage.getItem("activeKuch");
  };

  $scope.fetch = function (eemail) {
    var url = "/get-angular-dmed-records?kuchemail=" + eemail;
    $http.get(url).then(
      function (response) { $scope.jsonArray = response.data; },
      function (response) { alert(response.data); }
    );
  };

  $scope.dodelete = function (srno) {
    if (!confirm("Are you sure you want to unavail this medicine?")) return;
    $http.get("/dodelete?srkuch=" + srno).then(
      function (response) {
        alert(response.data);
        $scope.fetch($scope.eemail);
      },
      function (response) { alert(response.data); }
    );
  };
});
</script>
</head>

<body ng-controller="mycontroller" ng-init="setActiveUser()">

<!-- ===== NAVBAR ===== -->
<nav class="navbar px-3">
  <img src="pics/Navbarlogo-2.png" width="80">
  <span class="ms-3 fw-bold">Manage Medicines</span>
  <div class="ms-auto">
    <button class="btn btn-outline-danger" id="logout">Logout</button>
  </div>
</nav>

<!-- ===== CONTENT ===== -->
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-lg-9 col-md-10 col-12">

      <div class="glass-card">

        <h4 class="text-center mb-4">Your Donated Medicines ðŸ’Š</h4>

        <!-- EMAIL -->
        <div class="row justify-content-center mb-3">
          <div class="col-md-8">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" ng-model="eemail" readonly>
          </div>
        </div>

        <!-- FETCH BUTTON -->
        <div class="center mb-4">
          <button class="btn btn-main px-4" ng-click="fetch(eemail)">
            Fetch Records
          </button>
        </div>

        <!-- TABLE -->
        <div class="table-responsive">
          <table class="table table-bordered table-striped text-center align-middle">
            <thead>
              <tr>
                <th>#</th>
                <th>Medicine</th>
                <th>Expiry</th>
                <th>Packing</th>
                <th>Quantity</th>
                <th>Action</th>
              </tr>
            </thead>

            <tbody>
              <tr ng-repeat="obj in jsonArray">
                <td>{{$index+1}}</td>
                <td>{{obj.medicinename}}</td>
                <td>{{obj.expirydate}}</td>
                <td>{{obj.packingtype}}</td>
                <td>{{obj.quantity}}</td>
                <td>
                  <button class="btn btn-outline-danger btn-sm"
                          ng-click="dodelete(obj.srno)">
                    Unavail
                  </button>
                </td>
              </tr>

              <tr ng-if="!jsonArray || jsonArray.length==0">
                <td colspan="6" class="text-muted">No records found</td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
